# eeg_stage1_filter_mask_chep.txt
# First-pass EEG signal filtering and CHEP-based quality control

# Remove power line noise before filtering
LINE-DENOISE

# Apply bandpass filter to EEG signals only
FILTER sig=EEG_F7_O1,EEG_F8_O2,EEG_F8_F7,EEG_F8_O1,EEG_F7_O2
       bandpass=0.3,35
       ripple=0.01
       tw=0.5

# Restrict analysis to standard sleep stages
MASK ifnot=N1,N2,N3,R,W

# Apply CHEP masking for quality control
CHEP-MASK ep-th=3,3          # Drop epoch if >=3 channels fail
CHEP-MASK ch-th=2            # Drop channel if >=2 bad epochs
CHEP mask sig=EEG_F7_O1,EEG_F8_O2,EEG_F8_F7,EEG_F8_O1,EEG_F7_O2
CHEP dump                    # Output CHEP metrics (to redirect in script)

# Epoch-level metrics post-filtering
SIGSTATS epoch
PSD spectrum

